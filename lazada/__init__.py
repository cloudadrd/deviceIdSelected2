#
# pyspark \
# --driver-memory 10G \
# --executor-memory 10G \
# --num-executors 12 \
# --executor-cores 32
#
# df= spark.read.format("orc").load("oss://dmp-yeahmobi-com/hive_dataware/dmp/t_dmp_device_tag/day=20220701/platform=android/geo=IDN")
# df.createTempView("table")
# spark.sql("desc table").show(500,truncate=False)
# spark.sql("select * from table limit 5").show(500,truncate=False)
# """
# +------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+-------------+---------------+-------+----+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+
# |ifa                                 |bundles                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |osversion|ua                                                                                                                                                                  |make  |lastactiveday|ip             |country|lang|activedays                                                                                                                                                                                                                                                                                                                              |type|
# +------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+-------------+---------------+-------+----+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+
# |7464D84C-775E-48FF-BDB3-267204304907|[sg.bigo.live, messenger.social.chat.apps, me.pou.app, janda.browser.antiblokirproxy, id.savvydev.gendingjawaoffline, id.co.shopintar, game.puzzle.woodypuzzle, freeplay.crowdrun.com, com.wildspike.wormszone, com.uc.iflow, com.tvgo.live, com.tiltingpoint.spongebob, com.tapblaze.pizzabusiness, com.putusungkem.tayub.jawa.timuran.terbaik, com.putusungkem.gending.jawa.klasik.terbaik, com.putusungkem.campursari.ngetop.mp3.terbaru, com.putusungkem.campursari.mat.matan.mp3.terbaru, com.piixdart.campursari, com.picmax.wemoji, com.outfit7.talkinggingerfree, com.outfit7.mytalkingtomfree, com.outfit7.mytalkingangelafree, com.os.airforce, com.nearme.themespace, com.mnitareyang.guidetopoplantsvszombies2, com.mncgames.play.kikorun, com.mediastudio.allvideodownloader.downloadvideoshd.bestdownloader, com.livewallpapershq.roseslivewallpapers, com.lazada.android, com.lagu.campursari.mp3.populer, com.kiloo.subwaysurf, com.karawitan.gending.gamelan.jawa.terbaru, com.gendowor.Koleksi.Tembang.Kenangan, com.garawell.bridgerace, com.easybrain.block.puzzle.games, com.ea.game.pvzfree_row, com.differencetenderwhite.skirt, com.dar.modern.mods, com.crazylabs.sausage.io, com.cleanmaster.mguard, com.chillingo.robberybobfree.android.row, com.browser.pintar, com.brokepsimontok.browserantiblokir, com.boqepbf.browserbf, com.blockpuzzle.classicbrickgames, com.biandev.rahasiamanfaatdaunbidara, com.bf.browser, com.azka.browser.anti.blokir, com.app.scanner.qrcode.reader, com.andromo.dev442089.app465876, com.alquran.ayatkursi, com.UCMobile.intl, com.Locos.Telolet, com.Garawell.BridgeRace, apps.sanggabuana, apps.indie29, admobileapps.supranada, admobileapps.arsekamusic, com.mobile.legends, com.outfit7.mytalkingtom2, com.lenovo.anyshare.gps, com.heytap.themestore, com.quantum.videoplayer, com.outfit7.mytalkinghank, com.playit.videoplayer, com.nemo.vidmate, Vidmate, com.oppo.market]|9.0      |Mozilla/5.0 (Linux; Android 7.1.1; CPH1801 Build/NMF26F; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/87.0.4280.101 Mobile Safari/537.36           |oppo  |20220627     |114.5.242.55   |IDN    |-   |[131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 131, 123, 117, 83, 79, 26, 15, 9, 9, 9, 4]|2   |
# |AB6EBE9C-80DA-49EE-B4F4-E69D0C502003|[vinkle.video.editor, jp.garud.ssimulator, com.wildspike.wormszone, com.vivo.browser, com.vivo.appstore, com.tilemaster.puzzle.block.match, com.tempo.video.edit, com.tangiappsit.shiva.racing.hero, com.shazastudio.kode_remote_tv_universal, com.remote.control.universal.forall.tv, com.opera.mini.native, com.moonvideo.android.resso, com.michatapp.im, com.mastertv.remotealltv, com.games.cookiecarver, com.fingersoft.hillclimb, com.caffedegamers.wild.dragon.revenge.simulator]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                      |8.1.1    |Mozilla/5.0 (Linux; Android 8.1.0; vivo 1817 Build/OPM1.171019.026; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/96.0.4664.104 Mobile Safari/537.36|vivo  |20211229     |114.124.242.187|IDN    |id  |[184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184, 184]                                                                                                                                                                                                                                                   |2   |
# |B1B08710-F27F-4E9A-8CB8-25FCE777F7B0|[com.quantum.vmplayer, com.lenovo.anyshare.gps, com.jeyluta.timestampcamerafree, com.heytap.themestore, com.flatfish.cal.privacy, com.cleaner.boost.junk.system, com.android.browser, com.quantum.videoplayer, com.playit.videoplayer, com.udicorn.proxybrowser.unblockwebsites, apps.capricon.BetterSexLife, com.nemo.vidmate, com.heytap.browser]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            |9.0      |Mozilla/5.0 (Linux; Android 9; CPH1931 Build/PKQ1.190714.001; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/74.0.3729.136 Mobile Safari/537.36      |oppo  |20220630     |103.108.20.115 |IDN    |id  |[131, 131, 131, 131, 131, 131, 131, 51, 51, 40, 2, 1, 1]                                                                                                                                                                                                                                                                                |2   |
# |C2053C7F-FB45-4C48-A9DC-4495AC56DFFC|[com.wildspike.wormszone, com.rasugames.pls, com.opera.mini.native, com.mynamecubeapps.myname, com.fourinc.oleng.truck.simulator.indonesia, badminton.king.sportsgame.smash]                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                   |5.1.1    |Mozilla/5.0 (Linux; Android 5.1.1; Redmi 3 Build/LMY47V; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/95.0.4638.74 Mobile Safari/537.36            |xiaomi|20220126     |180.247.81.48  |IDN    |id  |[156, 156, 156, 156, 156, 156]                                                                                                                                                                                                                                                                                                          |2   |
# |9BD54C6E-787D-4D75-8664-8548B4D641E7|[word.block.puzzles.search.words, video.like, si.modula.android.instantheartrate, ninja.creed.sniper.real3d.action.free.android, net.mobigame.zombietsunami, mobisocial.arcade, mobi.gameguru.slapkings, com.yodo1.rodeo.safari, com.wildspike.wormszone, com.water.balls, com.unitedgames.mtb.downhill.bmx.racer, com.ucmobile.intl, com.time.trigger, com.tgame.girlgenius, com.spilgames.UphillRush, com.soccer.score.star, com.snaptube.premium, com.slingshot.car, com.rubygames.assassin, com.rage.road, com.playrix.township, com.oversea.luckydog.rewards, com.outfit7.mytalkingtom2, com.outfit7.movingeye.swampattack, com.opera.browser, com.ohmgames.knockdolls, com.ohbibi.sup, com.noxgroup.app.cleaner, com.mobirix.differencegame, com.miniclip.footballstrike, com.lenovo.anyshare.gps, com.lazada.android, com.knights.bikesstunt.motomaster, com.kiloo.subwaysurf, com.jakarta.baca, com.iposedon.bricksbreakerballs, com.igg.android.casinodeluxebyigg, com.hypercarrot.giantrush, com.hssoft.KungFuAttack3, com.heytap.themestore, com.heytap.browser, com.gold.miner.mania, com.gamexis.racing.ferocity.apps, com.gagalite.live, com.fungames.sniper3d, com.firsttouchgames.dls7, com.ea.game.pvzfree_row, com.dywx.larkplayer, com.dropping.ball.jungle.android, com.combineinc.streetracing.driftthreeD, com.colorup.game, com.chain.bikeshill, com.ball.sort.puzzle2021, com.amanotes.beathopper, com.UCMobile.intl, com.IEC.gang.clash, block.puzzle.sudoku.free.game.classic.offline, com.mobile.legends, site.realanime.animlov.animlov, com.dubox.drive, com.oppo.market]                                                                                                                                                                                                                                                                                                                                         |9.0      |Mozilla/5.0 (Linux; Android 8.1.0; CPH1909 Build/O11019; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/101.0.4951.61 Mobile Safari/537.36           |oppo  |20220602     |140.213.147.151|IDN    |-   |[128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 128, 93, 81, 33, 29]                           |2   |
# +------------------------------------+-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+---------+--------------------------------------------------------------------------------------------------------------------------------------------------------------------+------+-------------+---------------+-------+----+----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------+----+
#
# """
#
# sample_date = "20220702"
# df_1 = spark.read.format("orc").load("oss://sdkemr-yeahmobi/user/chensheng/pkg/lazada/IDN_android/sample_ana/%s_delay_2"%sample_date)
# df_1_fill = df_1.fillna(0,subset=["after_app_set_size"]).fillna(0,subset=["now_app_set_size"]).fillna(0,subset=["now_label"]).fillna(0,subset=["after_label"])
# df_1_fill.createTempView("%s_table"%sample_date)
# df_1_sample=spark.sql("\
#     select  \
#         device_id, osversion    \
#         , activeday_label_1_cnt, activeday_label_2_cnt, activeday_label_3_cnt, activeday_label_4_cnt, activeday_label_5_cnt, activeday_label_6_cnt, activeday_label_7_cnt, activeday_label_8_cnt, activeday_label_9_cnt, activeday_label_10_cnt \
#         , activeday_label_1_01, activeday_label_2_01, activeday_label_3_01, activeday_label_4_01, activeday_label_5_01, activeday_label_6_01, activeday_label_7_01, activeday_label_8_01, activeday_label_9_01, activeday_label_10_01   \
#         , activeday_label_11_cnt, activeday_label_12_cnt, activeday_label_13_cnt, activeday_label_14_cnt, activeday_label_15_cnt, activeday_label_16_cnt, activeday_label_17_cnt, activeday_label_18_cnt, activeday_label_19_cnt, activeday_label_20_cnt    \
#         , activeday_label_11_01, activeday_label_12_01, activeday_label_13_01, activeday_label_14_01, activeday_label_15_01, activeday_label_16_01, activeday_label_17_01, activeday_label_18_01, activeday_label_19_01, activeday_label_20_01  \
#         , activeday_label_21_cnt, activeday_label_22_cnt, activeday_label_23_cnt, activeday_label_24_cnt, activeday_label_25_cnt, activeday_label_26_cnt, activeday_label_27_cnt, activeday_label_28_cnt, activeday_label_29_cnt, activeday_label_30_cnt    \
#         , activeday_label_21_01, activeday_label_22_01, activeday_label_23_01, activeday_label_24_01, activeday_label_25_01, activeday_label_26_01, activeday_label_27_01, activeday_label_28_01, activeday_label_29_01, activeday_label_30_01  \
#         , bundles_size_label    \
#         , lastdaygap_label  \
#         ,case   \
#         when after_label=1 then 1   \
#         when after_label=0 and after_app_set_size > now_app_set_size then 2 \
#         else 3 end as label_temp    \
#     from    \
#         %s_table    \
#     where   \
#         lastdaygap_label <= 3   \
#         and now_app_set_size = 0    \
#         and now_label = 0"%sample_date)
# df_1_sample.repartition(200).write.mode("overwrite").orc("oss://sdkemr-yeahmobi/user/chensheng/pkg/lazada/IDN_android/sample/%s_delay_2_lastdaygap_3"%sample_date)